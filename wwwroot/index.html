<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Fashion CRM Pro - Keng qamrovli boshqaruv tizimi</title>
    <meta name="description" content="Professional fashion wholesale CRM with advanced analytics and management tools">

    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiRWxpdGUgRmFzaGlvbiBDUk0gUHJvIiwic2hvcnRfbmFtZSI6IkZhc2hpb25DUk0iLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJ0aGVtZV9jb2xvciI6IiM2NjdlZWEiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMjAyYyIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIyYVdWM1FtOTRQU0l3SURBZ01UQXdJREV3TUNJZ1ptbHNiRDBpSTJZM05qazJZeUlnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JajROUEM5emRtYysiLCJzaXplcyI6IjE5Mng5MiIsInR5cGUiOiJpbWFnZS9zdmcreG1sIn1dfQ==">

    <style>
        /* CSS Custom Properties for Dynamic Theming */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fdbb2d 0%, #22c1c3 100%);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --dark-glass: rgba(0, 0, 0, 0.1);
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 20px 60px rgba(0, 0, 0, 0.15);
            --shadow-strong: 0 30px 80px rgba(0, 0, 0, 0.2);
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --transition-fast: 0.2s ease;
            --transition-medium: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* Dark Mode Variables */
        [data-theme="dark"] {
            --text-primary: #e2e8f0;
            --text-secondary: #a0aec0;
            --glass-bg: rgba(0, 0, 0, 0.2);
            --dark-glass: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

            /* Animated Background */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle at 20% 20%, rgba(120, 119, 198, 0.3) 0%, transparent 50%), radial-gradient(circle at 80% 80%, rgba(255, 118, 117, 0.3) 0%, transparent 50%), radial-gradient(circle at 40% 40%, rgba(249, 168, 212, 0.2) 0%, transparent 50%);
                z-index: -1;
                animation: gradientShift 20s ease infinite;
            }

        @keyframes gradientShift {
            0%, 100% {
                opacity: 1;
            }

            50% {
                opacity: 0.8;
            }
        }

        /* Glass Morphism Container */
        .container {
            width: 95%;
            max-width: 1800px;
            margin: 2rem auto;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow-strong);
            overflow: hidden;
            position: relative;
        }

            .container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 1px;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
            }

        /* Modern Header */
        .header {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-bottom: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

            .header::before {
                content: '';
                position: absolute;
                top: -50%;
                left: -50%;
                width: 200%;
                height: 200%;
                background: conic-gradient(from 0deg, transparent, rgba(255,255,255,0.1), transparent);
                animation: rotate 20s linear infinite;
                z-index: -1;
            }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 800;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            padding: 0.5rem 1rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition-medium);
            backdrop-filter: blur(10px);
        }

            .theme-toggle:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-soft);
            }

        /* Advanced Sidebar */
        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 0;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border-right: 1px solid var(--glass-border);
            padding: 2rem;
            position: relative;
            overflow-y: auto;
        }

        .nav-menu {
            list-style: none;
            margin-bottom: 2rem;
        }

            .nav-menu li {
                margin-bottom: 0.5rem;
            }

        .nav-button {
            width: 100%;
            padding: 1rem 1.5rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition-medium);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

            .nav-button::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: var(--primary-gradient);
                transition: var(--transition-medium);
                z-index: -1;
            }

            .nav-button:hover::before,
            .nav-button.active::before {
                left: 0;
            }

            .nav-button:hover,
            .nav-button.active {
                color: white;
                transform: translateX(5px);
                box-shadow: var(--shadow-medium);
            }

        .nav-icon {
            font-size: 1.25rem;
            transition: var(--transition-medium);
        }

        .nav-button:hover .nav-icon {
            transform: scale(1.1);
        }

        /* Advanced Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            transition: var(--transition-medium);
        }

            .stat-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 4px;
                height: 100%;
                background: var(--primary-gradient);
                transition: var(--transition-medium);
            }

            .stat-card:nth-child(2)::before {
                background: var(--secondary-gradient);
            }

            .stat-card:nth-child(3)::before {
                background: var(--warning-gradient);
            }

            .stat-card:nth-child(4)::before {
                background: var(--success-gradient);
            }

            .stat-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-medium);
            }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Content Area */
        .content-area {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .action-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Advanced Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-medium);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow-soft);
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--text-primary);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Search and Filter */
        .search-filter-bar {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem 1rem;
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition-medium);
        }

            .search-input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition-medium);
        }

        /* Advanced Data Table */
        .table-container {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--glass-border);
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-soft);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

            .data-table th {
                background: var(--dark-glass);
                padding: 1rem;
                text-align: left;
                font-weight: 600;
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
                color: var(--text-primary);
                position: sticky;
                top: 0;
                z-index: 10;
                border-bottom: 1px solid var(--glass-border);
            }

            .data-table td {
                padding: 1rem;
                border-bottom: 1px solid var(--glass-border);
                color: var(--text-primary);
                position: relative;
            }

            .data-table tr {
                transition: var(--transition-fast);
            }

                .data-table tr:hover {
                    background: var(--dark-glass);
                }

                .data-table tr:last-child td {
                    border-bottom: none;
                }

        /* Status Badges */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .status-yangi {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .status-tasdiqlangan {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .status-tayyorlanmoqda {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .status-tolangan {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .status-jonatilishga-tayyor {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }

        .status-jonatilgan {
            background: rgba(14, 165, 233, 0.1);
            color: #0ea5e9;
        }

        .status-yetkazib-berildi {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .status-bekor-qilingan {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }

        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .chart-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
        }

            .chart-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--primary-gradient);
            }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Modal Enhancements */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            margin: 5% auto;
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            width: 90%;
            max-width: 600px;
            box-shadow: var(--shadow-strong);
            animation: modalSlideIn 0.3s ease;
            position: relative;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Form Enhancements */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition-medium);
        }

            .form-input:focus {
                outline: none;
                border-color: #667eea;
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }

        /* Loading States */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 100;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--glass-border);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Notification System */
        .notification-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 400px;
        }

        .notification {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow-strong);
            opacity: 0;
            transform: translateX(100%);
            animation: slideInNotification 0.3s ease forwards;
            position: relative;
            overflow: hidden;
        }

            .notification.success::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 4px;
                height: 100%;
                background: #22c55e;
            }

            .notification.error::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 4px;
                height: 100%;
                background: #ef4444;
            }

        @keyframes slideInNotification {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Analytics Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition-medium);
            position: relative;
            overflow: hidden;
        }

            .metric-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 2px;
                background: var(--primary-gradient);
            }

            .metric-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-medium);
            }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .metric-change {
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }

            .metric-change.positive {
                color: #22c55e;
            }

            .metric-change.negative {
                color: #ef4444;
            }

        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeInSection 0.3s ease;
        }

            .page-section.active {
                display: block;
            }

        @keyframes fadeInSection {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 280px 1fr;
            }
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                border-right: none;
                border-bottom: 1px solid var(--glass-border);
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .container {
                width: 98%;
                margin: 1rem auto;
            }

            .header {
                padding: 1.5rem;
            }

            .sidebar, .content-area {
                padding: 1.5rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .data-table {
                font-size: 0.875rem;
            }

                .data-table th,
                .data-table td {
                    padding: 0.75rem 0.5rem;
                }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--glass-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

            ::-webkit-scrollbar-thumb:hover {
                background: var(--secondary-gradient);
            }

        /* Advanced Hover Effects */
        .hover-lift {
            transition: var(--transition-medium);
        }

            .hover-lift:hover {
                transform: translateY(-3px);
                box-shadow: var(--shadow-medium);
            }

        /* Print Styles */
        @media print {
            .sidebar,
            .action-bar,
            .search-filter-bar {
                display: none;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .container {
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Advanced Header -->
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>🏭 Elite Fashion CRM Pro</h1>
                    <p style="color: var(--text-secondary); margin-top: 0.5rem;">Keng qamrovli professional boshqaruv tizimi</p>
                </div>
                <div class="header-actions">
                    <button class="theme-toggle" onclick="toggleTheme()">🌙 Dark Mode</button>
                    <button class="btn btn-primary" onclick="exportData()">📥 Export</button>
                    <button class="btn btn-secondary" onclick="printReport()">🖨️ Print</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <!-- Enhanced Sidebar -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li>
                        <button class="nav-button active" onclick="showPage('dashboard')" id="dashboard-btn">
                            <span class="nav-icon">📊</span>
                            <span>Bosh sahifa</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-button" onclick="showPage('orders')" id="orders-btn">
                            <span class="nav-icon">📦</span>
                            <span>Buyurtmalar</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-button" onclick="showPage('analytics')" id="analytics-btn">
                            <span class="nav-icon">📈</span>
                            <span>Tahlil va Prognoz</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-button" onclick="showPage('customers')" id="customers-btn">
                            <span class="nav-icon">👥</span>
                            <span>Mijozlar</span>
                        </button>
                    </li>
                    <li>
                        <button class="nav-button" onclick="showPage('geography')" id="geography-btn">
                            <span class="nav-icon">🗺️</span>
                            <span>Geografik Tahlil</span>
                        </button>
                    </li>
                </ul>

                <!-- Enhanced Stats -->
                <div class="stats-grid">
                    <div class="stat-card hover-lift">
                        <div class="stat-value" id="total-orders">0</div>
                        <div class="stat-label">Jami buyurtmalar</div>
                    </div>
                    <div class="stat-card hover-lift">
                        <div class="stat-value" id="total-revenue">$0</div>
                        <div class="stat-label">Jami daromad</div>
                    </div>
                    <div class="stat-card hover-lift">
                        <div class="stat-value" id="pending-orders">0</div>
                        <div class="stat-label">Kutilayotgan</div>
                    </div>
                    <div class="stat-card hover-lift">
                        <div class="stat-value" id="delivered-orders">0</div>
                        <div class="stat-label">Yetkazilgan</div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Content Area -->
            <div class="content-area">
                <div class="notification-container" id="notification-container"></div>

                <!-- Dashboard Page -->
                <div id="dashboard" class="page-section active">
                    <div class="content-header">
                        <h2 class="page-title">Boshqaruv Paneli</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="loadOrders()">
                                <span>🔄</span> Yangilash
                            </button>
                            <button class="btn btn-secondary" onclick="showPredictiveAnalytics()">
                                <span>🔮</span> Prognoz
                            </button>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card hover-lift">
                            <div class="metric-value" id="avg-order-value">$0</div>
                            <div class="metric-label">O'rtacha buyurtma qiymati</div>
                            <div class="metric-change positive" id="avg-change">+12.5%</div>
                        </div>
                        <div class="metric-card hover-lift">
                            <div class="metric-value" id="conversion-rate">0%</div>
                            <div class="metric-label">Konversiya darajasi</div>
                            <div class="metric-change positive" id="conv-change">+3.2%</div>
                        </div>
                        <div class="metric-card hover-lift">
                            <div class="metric-value" id="customer-retention">0%</div>
                            <div class="metric-label">Mijozlar ushlab qolish</div>
                            <div class="metric-change positive" id="retention-change">+8.1%</div>
                        </div>
                        <div class="metric-card hover-lift">
                            <div class="metric-value" id="growth-rate">0%</div>
                            <div class="metric-label">O'sish sur'ati</div>
                            <div class="metric-change positive" id="growth-change">+15.3%</div>
                        </div>
                    </div>

                    <div id="dashboard-content"></div>
                </div>

                <!-- Orders Page -->
                <div id="orders" class="page-section">
                    <div class="content-header">
                        <h2 class="page-title">Buyurtmalarni boshqarish</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="bulkAction('approve')">
                                <span>✅</span> Tanlanganlarni tasdiqlash
                            </button>
                            <button class="btn btn-warning" onclick="bulkAction('ship')">
                                <span>🚚</span> Jo'natish
                            </button>
                        </div>
                    </div>

                    <div class="search-filter-bar">
                        <input type="text" class="search-input" placeholder="🔍 Buyurtma, mijoz yoki tracking raqami bo'yicha qidiruv..." id="search-orders">
                        <select class="filter-select" id="status-filter">
                            <option value="">Barcha holatlar</option>
                            <option value="Yangi">Yangi</option>
                            <option value="Tasdiqlangan">Tasdiqlangan</option>
                            <option value="To'langan">To'langan</option>
                            <option value="Jo'natilishga tayyor">Jo'natilishga tayyor</option>
                            <option value="Jo'natilgan">Jo'natilgan</option>
                            <option value="Yetkazib berildi">Yetkazib berildi</option>
                            <option value="Bekor qilingan">Bekor qilingan</option>
                        </select>
                        <select class="filter-select" id="currency-filter">
                            <option value="">Barcha valyutalar</option>
                            <option value="USD">USD</option>
                            <option value="UZS">UZS</option>
                        </select>
                        <input type="date" class="form-input" id="date-filter" style="width: auto;">
                    </div>

                    <div id="orders-content"></div>
                </div>

                <!-- Advanced Analytics Page -->
                <div id="analytics" class="page-section">
                    <div class="content-header">
                        <h2 class="page-title">Kengaytirilgan Tahlil va Prognoz</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="generateReport()">
                                <span>📊</span> Hisobot yaratish
                            </button>
                            <button class="btn btn-secondary" onclick="predictTrends()">
                                <span>🔮</span> Trend Prognozi
                            </button>
                        </div>
                    </div>

                    <div id="analytics-content"></div>
                </div>

                <!-- Customers Page -->
                <div id="customers" class="page-section">
                    <div class="content-header">
                        <h2 class="page-title">Mijozlar Tahlili</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="exportCustomers()">
                                <span>👥</span> Mijozlar Eksport
                            </button>
                        </div>
                    </div>

                    <div id="customers-content"></div>
                </div>

                <!-- Geography Page -->
                <div id="geography" class="page-section">
                    <div class="content-header">
                        <h2 class="page-title">Geografik Tahlil</h2>
                        <div class="action-bar">
                            <button class="btn btn-primary" onclick="showRegionAnalytics()">
                                <span>🗺️</span> Hududiy Tahlil
                            </button>
                        </div>
                    </div>

                    <div id="geography-content"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Modal -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="margin: 0;">Buyurtma Ma'lumotlarini Tahrirlash</h2>
                <button style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary);" onclick="closeModal()">&times;</button>
            </div>

            <form id="edit-form">
                <input type="hidden" id="edit-order-id">

                <div class="form-group">
                    <label class="form-label">Mijoz nomi:</label>
                    <input type="text" class="form-input" id="customer-name-modal" readonly>
                </div>

                <div class="form-group">
                    <label class="form-label">Buyurtma holati:</label>
                    <select class="form-input" id="order-status-modal" required>
                        <option value="Yangi">Yangi</option>
                        <option value="Tasdiqlangan">Tasdiqlangan</option>
                        <option value="To'langan">To'langan</option>
                        <option value="Jo'natilishga tayyor">Jo'natilishga tayyor</option>
                        <option value="Jo'natilgan">Jo'natilgan</option>
                        <option value="Yetkazib berildi">Yetkazib berildi</option>
                        <option value="Bekor qilingan">Bekor qilingan</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Tracking raqam:</label>
                    <input type="text" class="form-input" id="tracking-number-modal">
                </div>

                <div class="form-group">
                    <label class="form-label">Eslatmalar:</label>
                    <textarea class="form-input" id="notes-modal" rows="3" placeholder="Qo'shimcha ma'lumotlar..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem;">
                    <span>💾</span> O'zgarishlarni saqlash
                </button>
            </form>
        </div>
    </div>

    <!-- Loading Overlay Template -->
    <div id="loading-template" style="display: none;">
        <div class="loading-overlay">
            <div class="loading-spinner"></div>
            <div class="loading-text">Ma'lumotlar yuklanmoqda...</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Global Variables
        let orders = [];
        let filteredOrders = [];
        let currentEditingId = null;
        let charts = {};
        let isDarkMode = false;

        const API_BASE = 'https://localhost:7080/api';

        // Utility Functions
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        const formatCurrency = (amount, currency = 'USD') => {
            const numAmount = parseFloat(amount) || 0;
            if (currency === 'UZS') {
                return new Intl.NumberFormat('uz-UZ', {
                    style: 'currency',
                    currency: 'UZS',
                    minimumFractionDigits: 0
                }).format(numAmount);
            }
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(numAmount);
        };

        const formatDate = (dateString) => {
            if (!dateString) return 'Belgilanmagan';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Noto\'g\'ri sana';
                return new Intl.DateTimeFormat('uz-UZ', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                }).format(date);
            } catch (e) {
                return 'Sana xatosi';
            }
        };

        const getStatusClass = (status) => {
            if (!status) return 'status-bekor-qilingan';
            return 'status-' + status.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/'/g, '')
                .replace(/ö/g, 'o')
                .replace(/ü/g, 'u');
        };

        // Theme Management
        const toggleTheme = () => {
            isDarkMode = !isDarkMode;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');

            const themeBtn = document.querySelector('.theme-toggle');
            themeBtn.innerHTML = isDarkMode ? '☀️ Light Mode' : '🌙 Dark Mode';
        };

        // Notification System
        const showNotification = (message, type = 'success') => {
            const container = document.getElementById('notification-container');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <span>${type === 'success' ? '✅' : '❌'}</span>
                    <span>${message}</span>
                </div>
            `;

            container.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 5000);
        };

        // Loading States
        const showLoading = (elementId) => {
            const element = document.getElementById(elementId);
            if (element) {
                const loading = document.getElementById('loading-template').cloneNode(true);
                loading.style.display = 'flex';
                loading.id = `loading-${elementId}`;
                element.style.position = 'relative';
                element.appendChild(loading);
            }
        };

        const hideLoading = (elementId) => {
            const loading = document.getElementById(`loading-${elementId}`);
            if (loading) loading.remove();
        };

        // API Functions
        const apiCall = async (url, options = {}) => {
            try {
                const response = await fetch(`${API_BASE}${url}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'accept': '*/*',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`API xatosi: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API chaqiruv xatosi:', error);
                throw error;
            }
        };

        const loadOrders = async () => {
            showLoading('dashboard-content');
            showLoading('orders-content');
            showLoading('analytics-content');

            try {
                const data = await apiCall('/Orders');
                orders = Array.isArray(data) ? data : [];
                filteredOrders = [...orders];

                updateStats();
                renderDashboard();
                renderOrders();

                if (document.getElementById('analytics').classList.contains('active')) {
                    renderAnalytics();
                }

                showNotification('Ma\'lumotlar muvaffaqiyatli yangilandi!', 'success');
            } catch (error) {
                console.error('Buyurtmalarni yuklash xatosi:', error);
                showNotification(`Xatolik: ${error.message}`, 'error');
                // Fallback to sample data
                orders = getSampleData();
                filteredOrders = [...orders];
                updateStats();
                renderDashboard();
                renderOrders();
            } finally {
                hideLoading('dashboard-content');
                hideLoading('orders-content');
                hideLoading('analytics-content');
            }
        };

        const updateOrderStatus = async () => {
            const newStatus = document.getElementById('order-status-modal').value;
            const trackingNumber = document.getElementById('tracking-number-modal').value;
            const notes = document.getElementById('notes-modal').value;

            if (!currentEditingId) return;

            try {
                const updateData = { status: newStatus };
                if (trackingNumber) updateData.trackingNumber = trackingNumber;
                if (notes) updateData.notes = notes;

                await apiCall(`/Orders/${currentEditingId}`, {
                    method: 'PUT',
                    body: JSON.stringify(updateData)
                });

                // Update local data
                const orderIndex = orders.findIndex(o => o.id === currentEditingId);
                if (orderIndex !== -1) {
                    orders[orderIndex] = { ...orders[orderIndex], ...updateData };
                    filteredOrders = [...orders];
                }

                updateStats();
                renderOrders();
                closeModal();
                showNotification('Buyurtma muvaffaqiyatli yangilandi!', 'success');
            } catch (error) {
                console.error('Buyurtma yangilash xatosi:', error);
                showNotification(`Xatolik: ${error.message}`, 'error');
            }
        };

        // Stats and Analytics
        const updateStats = () => {
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => {
                const amount = parseFloat(order.totalAmount) || 0;
                return sum + (order.currency === 'USD' ? amount : amount / 12500); // Rough USD conversion
            }, 0);

            const pendingOrders = orders.filter(o =>
                ['Yangi', 'Tasdiqlangan', 'To\'langan', 'Jo\'natilishga tayyor'].includes(o.status)
            ).length;

            const deliveredOrders = orders.filter(o => o.status === 'Yetkazib berildi').length;

            document.getElementById('total-orders').textContent = totalOrders.toLocaleString();
            document.getElementById('total-revenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('pending-orders').textContent = pendingOrders;
            document.getElementById('delivered-orders').textContent = deliveredOrders;

            // Update metrics
            const avgOrderValue = totalOrders > 0 ? totalRevenue / totalOrders : 0;
            const conversionRate = totalOrders > 0 ? (deliveredOrders / totalOrders) * 100 : 0;
            const customerRetention = calculateRetentionRate();
            const growthRate = calculateGrowthRate();

            document.getElementById('avg-order-value').textContent = formatCurrency(avgOrderValue);
            document.getElementById('conversion-rate').textContent = `${conversionRate.toFixed(1)}%`;
            document.getElementById('customer-retention').textContent = `${customerRetention.toFixed(1)}%`;
            document.getElementById('growth-rate').textContent = `${growthRate.toFixed(1)}%`;
        };

        const calculateRetentionRate = () => {
            const customers = new Set(orders.map(o => o.customerName));
            const repeatCustomers = new Set();

            orders.forEach(order => {
                const customerOrders = orders.filter(o => o.customerName === order.customerName);
                if (customerOrders.length > 1) {
                    repeatCustomers.add(order.customerName);
                }
            });

            return customers.size > 0 ? (repeatCustomers.size / customers.size) * 100 : 0;
        };

        const calculateGrowthRate = () => {
            const now = new Date();
            const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);
            const thisMonth = new Date(now.getFullYear(), now.getMonth(), 1);

            const lastMonthOrders = orders.filter(o => {
                const date = new Date(o.orderDate);
                return date >= lastMonth && date < thisMonth;
            }).length;

            const thisMonthOrders = orders.filter(o => {
                const date = new Date(o.orderDate);
                return date >= thisMonth;
            }).length;

            return lastMonthOrders > 0 ? ((thisMonthOrders - lastMonthOrders) / lastMonthOrders) * 100 : 0;
        };

        // Rendering Functions
        const renderDashboard = () => {
            const content = document.getElementById('dashboard-content');
            if (!orders.length) {
                content.innerHTML = '<div class="chart-card"><p>Hozircha buyurtmalar mavjud emas.</p></div>';
                return;
            }

            const recentOrders = [...orders]
                .sort((a, b) => new Date(b.orderDate) - new Date(a.orderDate))
                .slice(0, 10);

            content.innerHTML = `
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 class="chart-title">So'nggi buyurtmalar</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Mijoz</th>
                                        <th>Holat</th>
                                        <th>Summa</th>
                                        <th>Sana</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${recentOrders.map(order => `
                                        <tr onclick="openEditModal(${order.id})" style="cursor: pointer;">
                                            <td>#${order.id}</td>
                                            <td>${order.customerName || 'N/A'}</td>
                                            <td><span class="status-badge ${getStatusClass(order.status)}">${order.status || 'Noma\'lum'}</span></td>
                                            <td>${formatCurrency(order.totalAmount, order.currency)}</td>
                                            <td>${formatDate(order.orderDate)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Tezkor Statistika</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                            <div style="text-align: center; padding: 1rem; background: var(--glass-bg); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #22c55e;">${orders.filter(o => o.status === 'Yetkazib berildi').length}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Yetkazilgan</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--glass-bg); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #ef4444;">${orders.filter(o => o.status === 'Bekor qilingan').length}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Bekor qilingan</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--glass-bg); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #3b82f6;">${orders.filter(o => o.status === 'Jo\'natilgan').length}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Jo'natilgan</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: var(--glass-bg); border-radius: var(--border-radius-md);">
                                <div style="font-size: 1.5rem; font-weight: 700; color: #f59e0b;">${orders.filter(o => o.status === 'Tasdiqlangan').length}</div>
                                <div style="color: var(--text-secondary); font-size: 0.875rem;">Tasdiqlangan</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderOrders = () => {
            const content = document.getElementById('orders-content');
            if (!filteredOrders.length) {
                content.innerHTML = '<div class="chart-card"><p>Buyurtmalar topilmadi.</p></div>';
                return;
            }

            content.innerHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="select-all" onchange="toggleSelectAll()"></th>
                                <th>ID</th>
                                <th>Mijoz</th>
                                <th>Holat</th>
                                <th>Summa</th>
                                <th>Buyurtma sanasi</th>
                                <th>Yetkazib berish</th>
                                <th>Tracking</th>
                                <th>Amallar</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredOrders.map(order => `
                                <tr>
                                    <td><input type="checkbox" class="order-checkbox" value="${order.id}"></td>
                                    <td><strong>#${order.id}</strong></td>
                                    <td>
                                        <div style="line-height: 1.4;">
                                            <strong>${order.customerName || 'N/A'}</strong><br>
                                            <small style="color: var(--text-secondary);">${order.contactPhone || 'N/A'}</small>
                                        </div>
                                    </td>
                                    <td><span class="status-badge ${getStatusClass(order.status)}">${order.status || 'Noma\'lum'}</span></td>
                                    <td><strong>${formatCurrency(order.totalAmount, order.currency)}</strong></td>
                                    <td>${formatDate(order.orderDate)}</td>
                                    <td>${formatDate(order.deliveryDate)}</td>
                                    <td><code>${order.trackingNumber || 'N/A'}</code></td>
                                    <td>
                                        <button class="btn btn-primary" onclick="openEditModal(${order.id})" style="padding: 0.5rem;">
                                            ✏️
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 1rem; display: flex; justify-content: between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                    <div style="color: var(--text-secondary);">
                        Jami: ${filteredOrders.length} ta buyurtma
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" onclick="exportToCSV()">📊 CSV Export</button>
                        <button class="btn btn-secondary" onclick="exportToPDF()">📄 PDF Export</button>
                    </div>
                </div>
            `;
        };

        const renderAnalytics = () => {
            const content = document.getElementById('analytics-content');
            if (!orders.length) {
                content.innerHTML = '<div class="chart-card"><p>Tahlil uchun ma\'lumotlar yetarli emas.</p></div>';
                return;
            }

            // Prepare analytics data
            const statusStats = {};
            const monthlyRevenue = {};
            const customerRevenue = {};
            const regionStats = {};

            orders.forEach(order => {
                // Status statistics
                const status = order.status || 'Noma\'lum';
                statusStats[status] = (statusStats[status] || 0) + 1;

                // Monthly revenue
                if (order.orderDate) {
                    const date = new Date(order.orderDate);
                    if (!isNaN(date.getTime())) {
                        const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                        const amount = parseFloat(order.totalAmount) || 0;
                        const usdAmount = order.currency === 'USD' ? amount : amount / 12500;
                        monthlyRevenue[monthKey] = (monthlyRevenue[monthKey] || 0) + usdAmount;
                    }
                }

                // Customer revenue
                const customer = order.customerName || 'Noma\'lum';
                const amount = parseFloat(order.totalAmount) || 0;
                const usdAmount = order.currency === 'USD' ? amount : amount / 12500;
                customerRevenue[customer] = (customerRevenue[customer] || 0) + usdAmount;

                // Region statistics (extract from shipping address)
                if (order.shippingAddress) {
                    const region = order.shippingAddress.split(',')[0] || 'Noma\'lum';
                    regionStats[region] = (regionStats[region] || 0) + 1;
                }
            });

            content.innerHTML = `
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 class="chart-title">Buyurtmalar holati</h3>
                        <div class="chart-container">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Oylik daromad dinamikasi</h3>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Top 10 mijozlar</h3>
                        <div class="chart-container">
                            <canvas id="customerChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Hududlar bo'yicha taqsimot</h3>
                        <div class="chart-container">
                            <canvas id="regionChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="chart-card" style="margin-top: 2rem;">
                    <h3 class="chart-title">Batafsil Hisobot</h3>
                    <div class="metrics-grid" style="margin-top: 1rem;">
                        <div class="metric-card">
                            <div class="metric-value">${formatCurrency(orders.reduce((sum, o) => sum + (parseFloat(o.totalAmount) || 0) * (o.currency === 'USD' ? 1 : 1/12500), 0))}</div>
                            <div class="metric-label">Umumiy daromad (USD)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${new Set(orders.map(o => o.customerName)).size}</div>
                            <div class="metric-label">Noyob mijozlar</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${((orders.filter(o => o.status === 'Yetkazib berildi').length / orders.length) * 100).toFixed(1)}%</div>
                            <div class="metric-label">Muvaffaqiyat darajasi</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value">${formatCurrency((orders.reduce((sum, o) => sum + (parseFloat(o.totalAmount) || 0) * (o.currency === 'USD' ? 1 : 1/12500), 0)) / orders.length)}</div>
                            <div class="metric-label">O'rtacha buyurtma qiymati</div>
                        </div>
                    </div>
                </div>
            `;

            // Create charts
            setTimeout(() => createCharts(statusStats, monthlyRevenue, customerRevenue, regionStats), 100);
        };

        const createCharts = (statusStats, monthlyRevenue, customerRevenue, regionStats) => {
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};

            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: { size: 12 }
                        }
                    }
                }
            };

            const colors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe',
                '#00f2fe', '#43e97b', '#38f9d7', '#fdbb2d', '#22c1c3'
            ];

            // Status Chart
            const statusCtx = document.getElementById('statusChart');
            if (statusCtx) {
                charts.status = new Chart(statusCtx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusStats),
                        datasets: [{
                            data: Object.values(statusStats),
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: chartOptions
                });
            }

            // Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                const sortedRevenue = Object.entries(monthlyRevenue)
                    .sort(([a], [b]) => a.localeCompare(b))
                    .slice(-12); // Last 12 months

                charts.revenue = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: sortedRevenue.map(([month]) => month),
                        datasets: [{
                            label: 'Daromad (USD)',
                            data: sortedRevenue.map(([, revenue]) => revenue),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Customer Chart
            const customerCtx = document.getElementById('customerChart');
            if (customerCtx) {
                const topCustomers = Object.entries(customerRevenue)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 10);

                charts.customer = new Chart(customerCtx, {
                    type: 'bar',
                    data: {
                        labels: topCustomers.map(([name]) => name.length > 15 ? name.substring(0, 15) + '...' : name),
                        datasets: [{
                            label: 'Daromad (USD)',
                            data: topCustomers.map(([, revenue]) => revenue),
                            backgroundColor: colors[0],
                            borderRadius: 5
                        }]
                    },
                    options: {
                        ...chartOptions,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Region Chart
            const regionCtx = document.getElementById('regionChart');
            if (regionCtx) {
                charts.region = new Chart(regionCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(regionStats),
                        datasets: [{
                            data: Object.values(regionStats),
                            backgroundColor: colors,
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: chartOptions
                });
            }
        };

        // Search and Filter Functions
        const filterOrders = () => {
            const searchTerm = document.getElementById('search-orders').value.toLowerCase();
            const statusFilter = document.getElementById('status-filter').value;
            const currencyFilter = document.getElementById('currency-filter').value;
            const dateFilter = document.getElementById('date-filter').value;

            filteredOrders = orders.filter(order => {
                const matchesSearch = !searchTerm ||
                    order.customerName?.toLowerCase().includes(searchTerm) ||
                    order.trackingNumber?.toLowerCase().includes(searchTerm) ||
                    order.id.toString().includes(searchTerm);

                const matchesStatus = !statusFilter || order.status === statusFilter;
                const matchesCurrency = !currencyFilter || order.currency === currencyFilter;

                const matchesDate = !dateFilter ||
                    (order.orderDate && order.orderDate.startsWith(dateFilter));

                return matchesSearch && matchesStatus && matchesCurrency && matchesDate;
            });

            renderOrders();
        };

        // Bulk Operations
        const toggleSelectAll = () => {
            const selectAll = document.getElementById('select-all');
            const checkboxes = document.querySelectorAll('.order-checkbox');
            checkboxes.forEach(cb => cb.checked = selectAll.checked);
        };

        const bulkAction = async (action) => {
            const selectedIds = Array.from(document.querySelectorAll('.order-checkbox:checked'))
                .map(cb => parseInt(cb.value));

            if (!selectedIds.length) {
                showNotification('Iltimos, kamida bitta buyurtmani tanlang.', 'error');
                return;
            }

            const statusMap = {
                'approve': 'Tasdiqlangan',
                'ship': 'Jo\'natilgan'
            };

            const newStatus = statusMap[action];
            if (!newStatus) return;

            try {
                for (const id of selectedIds) {
                    await apiCall(`/Orders/${id}`, {
                        method: 'PUT',
                        body: JSON.stringify({ status: newStatus })
                    });

                    // Update local data
                    const orderIndex = orders.findIndex(o => o.id === id);
                    if (orderIndex !== -1) {
                        orders[orderIndex].status = newStatus;
                    }
                }

                filteredOrders = [...orders];
                updateStats();
                renderOrders();
                showNotification(`${selectedIds.length} ta buyurtma muvaffaqiyatli yangilandi!`, 'success');
            } catch (error) {
                showNotification(`Xatolik yuz berdi: ${error.message}`, 'error');
            }
        };

        // Export Functions
        const exportToCSV = () => {
            const headers = ['ID', 'Mijoz', 'Holat', 'Summa', 'Valyuta', 'Sana', 'Yetkazib berish', 'Tracking'];
            const csvContent = [
                headers.join(','),
                ...filteredOrders.map(order => [
                    order.id,
                    `"${order.customerName || ''}"`,
                    `"${order.status || ''}"`,
                    order.totalAmount || 0,
                    order.currency || '',
                    order.orderDate || '',
                    order.deliveryDate || '',
                    order.trackingNumber || ''
                ].join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `buyurtmalar_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        };

        const exportToPDF = () => {
            window.print();
        };

        // Modal Functions
        const openEditModal = (orderId) => {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            currentEditingId = orderId;
            document.getElementById('edit-order-id').value = order.id;
            document.getElementById('customer-name-modal').value = order.customerName || '';
            document.getElementById('order-status-modal').value = order.status || 'Yangi';
            document.getElementById('tracking-number-modal').value = order.trackingNumber || '';
            document.getElementById('notes-modal').value = order.notes || '';
            document.getElementById('edit-modal').style.display = 'block';
        };

        const closeModal = () => {
            document.getElementById('edit-modal').style.display = 'none';
        };

        // Page Navigation
        const showPage = (pageId) => {
            document.querySelectorAll('.page-section').forEach(page =>
                page.classList.remove('active'));
            document.querySelectorAll('.nav-button').forEach(btn =>
                btn.classList.remove('active'));

            const page = document.getElementById(pageId);
            const button = document.getElementById(pageId + '-btn');

            if (page) page.classList.add('active');
            if (button) button.classList.add('active');

            // Load page-specific content
            switch(pageId) {
                case 'analytics':
                    renderAnalytics();
                    break;
                case 'customers':
                    renderCustomers();
                    break;
                case 'geography':
                    renderGeography();
                    break;
            }
        };

        const renderCustomers = () => {
            const content = document.getElementById('customers-content');

            const customerStats = {};
            orders.forEach(order => {
                const customer = order.customerName || 'Noma\'lum';
                if (!customerStats[customer]) {
                    customerStats[customer] = {
                        name: customer,
                        orders: 0,
                        revenue: 0,
                        lastOrder: order.orderDate,
                        phone: order.contactPhone,
                        address: order.shippingAddress
                    };
                }
                customerStats[customer].orders++;
                const amount = parseFloat(order.totalAmount) || 0;
                customerStats[customer].revenue += order.currency === 'USD' ? amount : amount / 12500;
                if (new Date(order.orderDate) > new Date(customerStats[customer].lastOrder)) {
                    customerStats[customer].lastOrder = order.orderDate;
                }
            });

            const customers = Object.values(customerStats)
                .sort((a, b) => b.revenue - a.revenue);

            content.innerHTML = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mijoz</th>
                                <th>Buyurtmalar soni</th>
                                <th>Umumiy daromad</th>
                                <th>So'nggi buyurtma</th>
                                <th>Telefon</th>
                                <th>Manzil</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${customers.map(customer => `
                                <tr>
                                    <td><strong>${customer.name}</strong></td>
                                    <td>${customer.orders}</td>
                                    <td><strong>${formatCurrency(customer.revenue)}</strong></td>
                                    <td>${formatDate(customer.lastOrder)}</td>
                                    <td>${customer.phone || 'N/A'}</td>
                                    <td>${customer.address ? customer.address.substring(0, 30) + '...' : 'N/A'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        };

        const renderGeography = () => {
            const content = document.getElementById('geography-content');

            const regionStats = {};
            orders.forEach(order => {
                if (order.shippingAddress) {
                    const parts = order.shippingAddress.split(',');
                    const region = parts[0]?.trim() || 'Noma\'lum';

                    if (!regionStats[region]) {
                        regionStats[region] = { orders: 0, revenue: 0 };
                    }
                    regionStats[region].orders++;
                    const amount = parseFloat(order.totalAmount) || 0;
                    regionStats[region].revenue += order.currency === 'USD' ? amount : amount / 12500;
                }
            });

            const regions = Object.entries(regionStats)
                .map(([name, stats]) => ({ name, ...stats }))
                .sort((a, b) => b.revenue - a.revenue);

            content.innerHTML = `
                <div class="charts-grid">
                    <div class="chart-card">
                        <h3 class="chart-title">Hududlar bo'yicha daromad</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Hudud</th>
                                        <th>Buyurtmalar</th>
                                        <th>Daromad</th>
                                        <th>O'rtacha</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${regions.map(region => `
                                        <tr>
                                            <td><strong>${region.name}</strong></td>
                                            <td>${region.orders}</td>
                                            <td><strong>${formatCurrency(region.revenue)}</strong></td>
                                            <td>${formatCurrency(region.revenue / region.orders)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Top 5 hududlar</h3>
                        <div class="chart-container">
                            <canvas id="topRegionsChart"></canvas>
                        </div>
                    </div>
                </div>
            `;

            // Create chart
            setTimeout(() => {
                const ctx = document.getElementById('topRegionsChart');
                if (ctx) {
                    const top5 = regions.slice(0, 5);
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: top5.map(r => r.name),
                            datasets: [{
                                label: 'Daromad (USD)',
                                data: top5.map(r => r.revenue),
                                backgroundColor: '#667eea',
                                borderRadius: 5
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        };

        // Sample data fallback
        const getSampleData = () => {
            return [
                {
                    "id": 1,
                    "customerName": "Toshkent Fashion House",
                    "status": "Yetkazib berildi",
                    "orderDate": "2025-05-15T10:30:00Z",
                    "deliveryDate": "2025-05-20T14:00:00Z",
                    "totalAmount": 1500.50,
                    "currency": "USD",
                    "shippingAddress": "Toshkent sh., Amir Temur ko'ch. 123",
                    "contactPhone": "+998 90 123-45-67",
                    "trackingNumber": "TN2025001",
                    "notes": "Premium mijoz"
                },
                {
                    "id": 2,
                    "customerName": "Samarkand Textile",
                    "status": "Jo'natilgan",
                    "orderDate": "2025-05-20T08:15:00Z",
                    "deliveryDate": "2025-05-25T12:00:00Z",
                    "totalAmount": 2500000,
                    "currency": "UZS",
                    "shippingAddress": "Samarqand sh., Registon maydoni 1",
                    "contactPhone": "+998 91 234-56-78",
                    "trackingNumber": "TN2025002",
                    "notes": "Ulgurji buyurtma"
                }
            ];
        };

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                isDarkMode = true;
                document.documentElement.setAttribute('data-theme', 'dark');
                document.querySelector('.theme-toggle').innerHTML = '☀️ Light Mode';
            }

            // Setup search with debounce
            const searchInput = document.getElementById('search-orders');
            if (searchInput) {
                searchInput.addEventListener('input', debounce(filterOrders, 300));
            }

            // Setup filter listeners
            const filters = ['status-filter', 'currency-filter', 'date-filter'];
            filters.forEach(filterId => {
                const element = document.getElementById(filterId);
                if (element) {
                    element.addEventListener('change', filterOrders);
                }
            });

            // Setup modal
            const modal = document.getElementById('edit-modal');
            const form = document.getElementById('edit-form');

            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    updateOrderStatus();
                });
            }

            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });

            // Load initial data
            loadOrders();
        });

        // Expose functions to global scope for onclick handlers
        window.showPage = showPage;
        window.loadOrders = loadOrders;
        window.openEditModal = openEditModal;
        window.closeModal = closeModal;
        window.toggleTheme = toggleTheme;
        window.bulkAction = bulkAction;
        window.exportToCSV = exportToCSV;
        window.exportToPDF = exportToPDF;
        window.toggleSelectAll = toggleSelectAll;
    </script>
</body>

</html>